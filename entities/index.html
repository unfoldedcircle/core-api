<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Entities - Unfolded Circle API Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Unfolded Circle API Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="entities"><a class="header" href="#entities">Entities</a></h1>
<p>Entities represent devices by describing features and exposing controls. An integration can offer available entities for
control. The user might select and configure entities, that will be available for the user interface.</p>
<p>Based on the entity type, device class and features, a specific user interface is shown. These features and other entity
characteristics are set by the integration.</p>
<p>An integration driver provides entity definitions to the remote which then can be used in profiles and pages for the
user to interact with the device.</p>
<p>Whenever the user interacts with an entity from an integration driver, the remote sends command requests to the
integration driver. Once the entity or physical device has been updated the integration driver sends a change event
message back to the remote to notify it about the updated state or attribute(s).</p>
<p>Supported entities:</p>
<ul>
<li><a href="entity_button.html">Button</a></li>
<li><a href="entity_switch.html">Switch</a></li>
<li><a href="entity_climate.html">Climate</a></li>
<li><a href="entity_cover.html">Cover</a></li>
<li><a href="entity_light.html">Light</a></li>
<li><a href="entity_media_player.html">Media Player</a></li>
<li><a href="entity_remote.html">Remote</a></li>
<li><a href="entity_sensor.html">Sensor</a></li>
<li><a href="entity_ir_emitter.html">IR-Emitter</a></li>
<li><a href="entity_select.html">Select</a></li>
<li><a href="entity_voice_assistant.html">Voice Assistant</a></li>
</ul>
<p>The üöß icon within the entity descriptions indicates a planned feature.</p>
<h2 id="integration-api"><a class="header" href="#integration-api">Integration API</a></h2>
<p>To make entities available to the remote, an integration driver needs to provide <code>entity</code> definition for each entity
instance, filled with entity type specific data.</p>
<p>The remote retrieves the available entities from the integration driver with the <code>get_available_entities</code> request
message:</p>
<pre><code class="language-json">{
  "kind": "req",
  "id": 11,
  "msg": "get_available_entities"
}
</code></pre>
<p>The integration driver then responds with the <code>available_entities</code> message containing all entity definitions:</p>
<pre><code class="language-json">{
  "kind": "resp",
  "req_id": 11,
  "msg": "available_entities",
  "code": 200,
  "msg_data": {
    "available_entities": [
      {
        "entity_id": "button-1",
        "entity_type": "button",
        "name": {
          "en": "Ring dinner bell"
        }
      },
      {
        "entity_id": "blind-1",
        "entity_type": "cover",
        "device_class": "blind",
        "features": [
          "open",
          "close",
          "stop",
          "position"
        ],
        "name": {
          "en": "Living room blinds",
          "de": "Wohnzimmer Jalousien"
        }
      },
      {
        "entity_id": "light-1",
        "entity_type": "light",
        "features": [
          "on_off",
          "dim",
          "colour"
        ],
        "name": {
          "en": "Living room"
        }
      }
    ]
  }
}
</code></pre>
<p>All entities share a set of common attributes like <code>name</code> and the <code>UNAVAILABLE</code>, <code>UNKNOWN</code> states.
An entity implementation defines additional features, attributes, states and options which need to be handled in the
driver implementation.</p>
<p>Please see <a href="https://unfoldedcircle.github.io/core-api/integration/">Integration AsyncAPI definition</a> for more information and additional options.</p>
<h3 id="common-entity-definition"><a class="header" href="#common-entity-definition">Common entity definition</a></h3>
<p>All entities share the following properties in the <code>entity</code> structure:</p>
<div class="table-wrapper"><table><thead><tr><th>Entity property</th><th>Description</th></tr></thead><tbody>
<tr><td>entity_id</td><td>Unique identifier of the entity for command and event messages.</td></tr>
<tr><td>entity_type</td><td>Entity device type name: one of the supported entities.</td></tr>
<tr><td>device_id</td><td>Optional associated device, if the integration driver supports multiple devices.</td></tr>
<tr><td>features</td><td>Supported features of the entity. See concrete entity definition for available features.</td></tr>
<tr><td>name</td><td>Human readable name of the entity or device. Default value of the entity name for the entity configuration in the remote. Changeable by the user.</td></tr>
<tr><td>area</td><td>Optional area name, e.g. <code>Living room</code>. This information might be used by the UI in the setup process to automatically create profile pages for all areas returned in the available entities.</td></tr>
</tbody></table>
</div>
<h3 id="features"><a class="header" href="#features">Features</a></h3>
<p>The entity features define the controllable properties of an entity. They also influence how an entity is shown in the
UI, e.g. if there are dimmer and colour selection controls for a lamp, or blind position controls.</p>
<h3 id="attributes"><a class="header" href="#attributes">Attributes</a></h3>
<p>Entity attributes are controlled or influenced by features. A features can act on multiple attributes,
e.g. the open command for a cover entity will set the state and if supported, also the current position of the cover.</p>
<p>An attribute value should represent the correct state of the physical device being controlled whenever possible. An
integration driver might simulate intermediate states and position values, if the current state is either not readable
from the device or involves expensive operations. E.g. if it's known that opening a window blind takes 30 seconds, the
integration driver can start a timer and send approximated status updates during the opening time frame.<br />
This will show a nice animation in the remote UI instead of immediately jumping from closed to open while the physical
blind is still opening.</p>
<h3 id="states"><a class="header" href="#states">States</a></h3>
<p>The entity <code>state</code> attribute holds the following common values which an integration driver can choose to support:</p>
<div class="table-wrapper"><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td>UNAVAILABLE</td><td>The entity is currently not available. The UI will render the entity as inactive until the entity becomes active again.</td></tr>
<tr><td>UNKNOWN</td><td>The entity is available but the current state is unknown.</td></tr>
</tbody></table>
</div>
<h3 id="device-classes"><a class="header" href="#device-classes">Device classes</a></h3>
<p>An entity type can be further classified by an optional device class. This has mainly an influence on the UI
representation how an entity is presented to a user. E.g. a <code>cover</code> entity has multiple device classes like <code>blind</code> or
<code>garage</code>.</p>
<h3 id="options"><a class="header" href="#options">Options</a></h3>
<p>Options are feature modifiers to customize certain behaviour, e.g. the default <code>on_off</code> feature for a switch expects the
current state to be retrievable. If a switch can't provide its current state, it becomes a toggle switch with setting
the <code>readable</code> option to <code>false</code>.</p>
<h3 id="commands"><a class="header" href="#commands">Commands</a></h3>
<p>For all user or scene interactions with an entity, like switching it on or changing an attribute, the remote sends an
<code>entity_command</code> message to the integration driver. This message contains the entity command with optional parameters
to execute by the driver:</p>
<pre><code class="language-json">{
  "kind": "req",
  "id": 123,
  "msg": "entity_command",
  "msg_data": {
    "entity_type": "$TYPE",
    "entity_id": "$ID",
    "cmd_id": "$COMMAND",
    "params": {
      "$ParameterName1": "$ParameterValue1",
      "$ParameterName2": "$ParameterValue2",
      "$ParameterNameN": "$ParameterValueN"
    }
  }
}
</code></pre>
<ul>
<li>The command is specified in <code>msg_data.cmd_id</code>.
<ul>
<li>Optional command parameters are passed as key / value pairs under <code>msg_data.params</code>.</li>
<li>The available commands and parameters are specified in the corresponding entity documentation.</li>
</ul>
</li>
<li>The command request must be acknowledged with a <code>result</code> response message.
<ul>
<li>If at the time of receiving the command the driver already knows that it can't execute the command, it can send
back an error to notify that the command execution is not possible.<br />
Otherwise, the remote assumes that the command is executed.</li>
</ul>
</li>
<li>Once the value has been set or confirmed by the physical device, an <code>entity_change</code> event message must be sent by the
integration driver with the new value(s). Of course, this only applies to stateful attributes and not to buttons or
"fire and forget" commands.</li>
</ul>
<h3 id="events"><a class="header" href="#events">Events</a></h3>
<p>The <code>entity_change</code> event must be emitted by the integration driver if the state of the entity changes. Either after an
<code>entity_command</code> or if the entity has been updated otherwise, e.g. externally through a user or another system.<br />
This keeps the remote in sync with the real state of the entity without the need of constant polling.</p>
<p>Event message structure:</p>
<pre><code class="language-json">{
  "kind": "event",
  "msg": "entity_change",
  "cat": "ENTITY",
  "msg_data": {
    "entity_type": "$TYPE",
    "entity_id": "$ID",
    "attributes": {
      "$Attribute1": "$Value1",
      "$Attribute2": "$Value2",
      "$AttributeN": "$ValueN"
    }
  }
}
</code></pre>
<p>The available <code>$Attribute(s)</code> and their <code>$Value(s)</code> are specified in the entity documentation.</p>
<p>Common event attributes available for all entities:</p>
<div class="table-wrapper"><table><thead><tr><th>Attribute</th><th>Description</th></tr></thead><tbody>
<tr><td>state</td><td>New entity state.</td></tr>
</tbody></table>
</div>
<p>At least one attribute must be specified in the <code>entity_change</code> message. If the common entity <code>state</code> and an addition
attribute changed at the same time, they may both be included in the same message. It's also valid to always send every
entity attribute. The remote will filter out non-changed attributes and only update changes in the UI.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../discovery.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../entities/entity_button.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../discovery.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../entities/entity_button.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
